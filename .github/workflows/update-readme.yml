name: ðŸ› ï¸ Update README Stats

on:
  push:
    branches: [main]
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Clone repository
        uses: actions/checkout@v3

      - name: Count Problems and Languages
        run: |
          EASY=$(find easy -type f 2>/dev/null | wc -l)
          MEDIUM=$(find medium -type f 2>/dev/null | wc -l)
          HARD=$(find hard -type f 2>/dev/null | wc -l)
          TOTAL=$((EASY + MEDIUM + HARD))
          LANGS=$(find easy medium hard -type f 2>/dev/null | sed 's/.*\.//' | sort | uniq | wc -l)

          NEW_STATS="<!-- STATS_START -->
## ðŸ“Š Stats
- ðŸ”¢ Problems Solved: $TOTAL
  - ðŸŸ¢ Easy: $EASY
  - ðŸŸ  Medium: $MEDIUM
  - ðŸ”´ Hard: $HARD
- ðŸ§© Languages: $LANGS
<!-- STATS_END -->"

          # Replace or insert the block
          if grep -q "<!-- STATS_START -->" README.md; then
            # Replace between the markers
            sed -i '/<!-- STATS_START -->/,/<!-- STATS_END -->/c\'"$NEW_STATS" README.md
          else
            # Insert after first H1 heading if block not found
            sed -i "/^# .*$/a $NEW_STATS" README.md
          fi

      - name: Commit and Push
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add README.md
          git commit -m "ðŸ§® Auto-update stats section (clean replace)"
          git push
