name: 🛠️ Update README Stats

on:
  push:
    branches: [main]
  schedule:
    - cron: '0 0 * * *'  # Runs daily
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Clone repository
        uses: actions/checkout@v3

      - name: Count Problems and Languages
        run: |
          EASY=$(find easy -type f 2>/dev/null | wc -l)
          MEDIUM=$(find medium -type f 2>/dev/null | wc -l)
          HARD=$(find hard -type f 2>/dev/null | wc -l)
          TOTAL=$((EASY + MEDIUM + HARD))
          LANGS=$(find easy medium hard -type f 2>/dev/null | sed 's/.*\.//' | sort | uniq | wc -l)

          # Remove old stats block (if present)
          sed -i '/🔢 Problems Solved:/,/🧩 Languages:/d' README.md

          # Insert updated stats after first heading
          sed -i "/^# .*$/a \\\n## 📊 Stats\n- 🔢 Problems Solved: $TOTAL\n  - 🟢 Easy: $EASY\n  - 🟠 Medium: $MEDIUM\n  - 🔴 Hard: $HARD\n- 🧩 Languages: $LANGS\n" README.md

      - name: Commit and Push
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add README.md
          git commit -m "🧮 Auto-update problem count, difficulty breakdown, and languages"
          git push
