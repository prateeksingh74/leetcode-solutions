name: ðŸ› ï¸ Update README Stats

on:
  push:
    branches: [main]
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Clone repository
        uses: actions/checkout@v3

      - name: Build README Sections
        run: |
          EASY=$(find easy -type f 2>/dev/null | wc -l)
          MEDIUM=$(find medium -type f 2>/dev/null | wc -l)
          HARD=$(find hard -type f 2>/dev/null | wc -l)
          TOTAL=$((EASY + MEDIUM + HARD))
          LANGS=$(find easy medium hard -type f 2>/dev/null | sed 's/.*\.//' | sort -u | wc -l)

          GOAL=150
          PERCENT=$((TOTAL * 100 / GOAL))
          DONE_BLOCKS=$((PERCENT / 5))
          EMPTY_BLOCKS=$((20 - DONE_BLOCKS))
          BAR=$(printf "%${DONE_BLOCKS}s" | tr ' ' 'â–“')$(printf "%${EMPTY_BLOCKS}s" | tr ' ' 'â–‘')

          echo "<!-- STATS_START -->" > stats_section.md
          echo "## ðŸ“Š Stats" >> stats_section.md
          echo "- ðŸ”¢ Problems Solved: $TOTAL / $GOAL" >> stats_section.md
          echo "  - ðŸŸ¢ Easy: $EASY" >> stats_section.md
          echo "  - ðŸŸ  Medium: $MEDIUM" >> stats_section.md
          echo "  - ðŸ”´ Hard: $HARD" >> stats_section.md
          echo "- ðŸ§© Languages: $LANGS" >> stats_section.md
          echo "- ðŸŽ¯ Goal: Top 150 LeetCode Problems" >> stats_section.md
          echo "  - $BAR $TOTAL/$GOAL (${PERCENT}%)" >> stats_section.md
          echo "<!-- STATS_END -->" >> stats_section.md

          echo "<!-- TRACKER_START -->" > tracker_section.md
          echo "## ðŸ“… Progress Tracker" >> tracker_section.md
          echo "| # | Title | Difficulty | Language | Status |" >> tracker_section.md
          echo "|---|-------|------------|----------|--------|" >> tracker_section.md

          for f in $(find easy medium hard -type f); do
            NUM=$(echo $f | sed -E 's/.*\/([0-9]+)-.*/\1/')
            TITLE=$(echo $f | sed -E 's/.*\/[0-9]+-([a-z0-9\-]+)\..*/\1/' | sed 's/-/ /g' | sed 's/\b\(.\)/\u\1/g')
            DIFFICULTY=$(echo $f | cut -d/ -f1 | tr '[:lower:]' '[:upper:]')
            LANG=$(echo $f | awk -F. '{print $NF}' | tr '[:lower:]' '[:upper:]')
            echo "| $NUM | $TITLE | $DIFFICULTY | $LANG | âœ… |" >> tracker_section.md
          done

          echo "<!-- TRACKER_END -->" >> tracker_section.md

      - name: Update README.md
        run: |
          sed -i '/<!-- STATS_START -->/,/<!-- STATS_END -->/d' README.md
          sed -i '/^# .*$/a <!-- STATS_START -->\n<!-- STATS_END -->' README.md
          sed -i "/<!-- STATS_START -->/r stats_section.md" README.md

          sed -i '/<!-- TRACKER_START -->/,/<!-- TRACKER_END -->/d' README.md
          echo -e "\n<!-- TRACKER_START -->\n<!-- TRACKER_END -->" >> README.md
          sed -i "/<!-- TRACKER_START -->/r tracker_section.md" README.md

      - name: Commit and Push
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add README.md
          git commit -m "ðŸ§® Auto-update stats and progress tracker"
          git push
